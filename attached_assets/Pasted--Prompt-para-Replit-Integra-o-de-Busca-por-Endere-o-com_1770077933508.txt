# Prompt para Replit - Integra√ß√£o de Busca por Endere√ßo com BrasilAPI

## üéØ Objetivo
Atualizar seu sistema atual para permitir busca de CEP e geolocaliza√ß√£o **pelo endere√ßo completo** (rua, n√∫mero, bairro, cidade, estado) em vez de apenas pelo CEP.

---

## üìã Instru√ß√µes para o Replit

Copie e cole este prompt no Replit AI (ou qualquer LLM que voc√™ usar):

---

### PROMPT PARA COPIAR E COLAR:

```
Preciso atualizar meu sistema de busca de CEP para aceitar busca por ENDERE√áO COMPLETO.

REQUISITOS:
1. O usu√°rio deve poder digitar um endere√ßo completo (ex: "Rua das Flores, 123, S√£o Paulo, SP")
2. O sistema deve usar Google Geocoding API para converter o endere√ßo em coordenadas (latitude, longitude)
3. Depois de obter as coordenadas, buscar o CEP correspondente na BrasilAPI V2
4. Exibir no mapa interativo: marcador com a localiza√ß√£o, infowindow com dados
5. Mostrar os resultados: CEP, endere√ßo, cidade, estado, bairro, latitude, longitude

FLUXO T√âCNICO:
1. Input: Campo de texto para endere√ßo completo
2. Valida√ß√£o: Verificar se endere√ßo tem pelo menos 5 caracteres
3. Geocodifica√ß√£o: Usar Google Geocoding API para obter lat/lng
4. Busca de CEP: Usar BrasilAPI V2 (https://brasilapi.com.br/api/cep/v2/{cep})
5. Exibi√ß√£o: Mostrar marcador no mapa, dados em card, infowindow autom√°tico

APIS A USAR:
- Google Geocoding API (j√° integrada no projeto)
- BrasilAPI V2: GET https://brasilapi.com.br/api/cep/v2/{cep}
- OpenStreetMap Nominatim (opcional, para reverse geocoding): GET https://nominatim.openstreetmap.org/reverse?format=json&lat={lat}&lon={lng}

EXEMPLO DE RESPOSTA ESPERADA:
{
  "address": "Rua das Flores, 123, S√£o Paulo, SP, Brasil",
  "latitude": -23.5505,
  "longitude": -46.6333,
  "cep": "01310930",
  "state": "SP",
  "city": "S√£o Paulo",
  "neighborhood": "Centro",
  "street": "Rua das Flores"
}

COMPONENTES A MODIFICAR:
1. Input field: Trocar de "CEP" para "Endere√ßo Completo"
2. Fun√ß√£o de busca: Criar fun√ß√£o geocodeAddress() que chama Google Geocoding
3. Fun√ß√£o de CEP: Adaptar para buscar CEP pela coordenada
4. Mapa: Atualizar para exibir marcador nas coordenadas geocodificadas
5. Valida√ß√£o: Aceitar endere√ßos com m√≠nimo 5 caracteres

TRATAMENTO DE ERROS:
- Endere√ßo n√£o encontrado: Mostrar mensagem "Endere√ßo n√£o encontrado. Tente ser mais espec√≠fico."
- CEP n√£o encontrado: Mostrar mensagem "CEP n√£o encontrado para esta localiza√ß√£o"
- Erro de rede: Mostrar mensagem de erro gen√©rica

MELHORIAS OPCIONAIS:
- Adicionar autocomplete de endere√ßo (Google Places Autocomplete)
- Permitir busca por CEP tamb√©m (manter compatibilidade)
- Hist√≥rico de buscas com localStorage
- Exportar resultado em PDF/CSV
```

---

## üîß Implementa√ß√£o Passo a Passo

### Passo 1: Atualizar o Input
**Trocar de:**
```html
<input placeholder="00000-000" type="text" />
```

**Para:**
```html
<input placeholder="Ex: Rua das Flores, 123, S√£o Paulo, SP" type="text" />
```

---

### Passo 2: Criar Fun√ß√£o de Geocodifica√ß√£o
**Adicionar esta fun√ß√£o:**

```javascript
async function geocodeAddress(addressText) {
  if (!map) {
    console.error("Mapa n√£o est√° pronto");
    return;
  }

  const geocoder = new google.maps.Geocoder();

  geocoder.geocode({ address: addressText }, async (results, status) => {
    if (status === "OK" && results && results[0]) {
      const result = results[0];
      const lat = result.geometry.location.lat();
      const lng = result.geometry.location.lng();
      const formattedAddress = result.formatted_address;

      // Extrair componentes do endere√ßo
      let street = "";
      let city = "";
      let state = "";
      let neighborhood = "";

      result.address_components.forEach((component) => {
        if (component.types.includes("route")) {
          street = component.long_name;
        }
        if (component.types.includes("administrative_area_level_2")) {
          city = component.long_name;
        }
        if (component.types.includes("administrative_area_level_1")) {
          state = component.short_name;
        }
        if (component.types.includes("sublocality_level_1")) {
          neighborhood = component.long_name;
        }
      });

      // Buscar CEP usando OpenStreetMap Nominatim
      try {
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`
        );
        const osmData = await response.json();
        
        let cepData = null;
        if (osmData.address && osmData.address.postcode) {
          // Buscar dados completos na BrasilAPI
          const cepResponse = await fetch(
            `https://brasilapi.com.br/api/cep/v2/${osmData.address.postcode}`
          );
          if (cepResponse.ok) {
            cepData = await cepResponse.json();
          }
        }

        // Preparar dados para exibi√ß√£o
        const locationData = {
          address: formattedAddress,
          latitude: lat,
          longitude: lng,
          street: street || cepData?.street,
          city: city || cepData?.city,
          state: state || cepData?.state,
          neighborhood: neighborhood || cepData?.neighborhood,
          cep: cepData?.cep,
          service: cepData?.service || "google_maps"
        };

        // Atualizar mapa e exibir resultados
        updateMapLocation(lat, lng, locationData);
        displayResults(locationData);

      } catch (error) {
        console.error("Erro ao buscar CEP:", error);
        // Exibir resultado mesmo sem CEP
        const locationData = {
          address: formattedAddress,
          latitude: lat,
          longitude: lng,
          street: street,
          city: city,
          state: state,
          neighborhood: neighborhood
        };
        updateMapLocation(lat, lng, locationData);
        displayResults(locationData);
      }
    } else {
      console.error("Geocode n√£o foi bem-sucedido por: " + status);
      showError("Endere√ßo n√£o encontrado. Tente ser mais espec√≠fico.");
    }
  });
}
```

---

### Passo 3: Atualizar Fun√ß√£o de Busca
**Trocar a chamada de busca de:**
```javascript
searchCEP(cepValue)
```

**Para:**
```javascript
geocodeAddress(addressValue)
```

---

### Passo 4: Atualizar Valida√ß√£o
**Trocar de:**
```javascript
if (cep.length !== 8) {
  // erro
}
```

**Para:**
```javascript
if (address.trim().length < 5) {
  // erro
}
```

---

### Passo 5: Atualizar Exibi√ß√£o de Resultados
**Adicionar campos:**
- Endere√ßo completo (do Google Geocoding)
- Latitude e Longitude
- CEP (se encontrado)
- Cidade, Estado, Bairro

---

## üó∫Ô∏è Exemplo de Resposta do Mapa

Quando o usu√°rio buscar "Avenida Paulista, 1000, S√£o Paulo, SP", o sistema deve:

1. ‚úÖ Geocodificar e obter: lat: -23.5614, lng: -46.6560
2. ‚úÖ Buscar CEP: 01311100
3. ‚úÖ Exibir marcador no mapa
4. ‚úÖ Mostrar infowindow com dados
5. ‚úÖ Exibir card com resultado completo

---

## üîó Refer√™ncias de API

### Google Geocoding (j√° integrada)
```javascript
const geocoder = new google.maps.Geocoder();
geocoder.geocode({ address: "endere√ßo aqui" }, callback);
```

### BrasilAPI V2
```
GET https://brasilapi.com.br/api/cep/v2/{cep}
Resposta:
{
  "cep": "01310930",
  "state": "SP",
  "city": "S√£o Paulo",
  "neighborhood": "Centro",
  "street": "Rua Doutor Luiz de Freitas Melro",
  "location": {
    "type": "Point",
    "coordinates": {
      "latitude": -23.5614,
      "longitude": -46.6560
    }
  }
}
```

### OpenStreetMap Nominatim (Reverse Geocoding)
```
GET https://nominatim.openstreetmap.org/reverse?format=json&lat={lat}&lon={lng}
Resposta inclui: address.postcode (CEP)
```

---

## ‚úÖ Checklist de Implementa√ß√£o

- [ ] Atualizar input field para aceitar endere√ßo
- [ ] Criar fun√ß√£o geocodeAddress()
- [ ] Integrar com Google Geocoding API
- [ ] Integrar com OpenStreetMap Nominatim
- [ ] Integrar com BrasilAPI V2
- [ ] Atualizar fun√ß√£o de exibi√ß√£o de resultados
- [ ] Atualizar valida√ß√£o de entrada
- [ ] Testar com v√°rios endere√ßos
- [ ] Adicionar tratamento de erros
- [ ] Testar no mapa (marcador, zoom, infowindow)

---

## üéì Dicas Importantes

1. **Google Geocoding √© mais preciso** que OpenStreetMap para endere√ßos brasileiros
2. **OpenStreetMap Nominatim √© gratuito** e n√£o precisa de chave de API
3. **BrasilAPI pode n√£o encontrar CEP** para todas as coordenadas (usar como complemento)
4. **Sempre validar entrada** do usu√°rio (m√≠nimo 5 caracteres)
5. **Usar try-catch** para tratamento de erros de rede

---

## üìû Suporte

Se tiver d√∫vidas:
- Documenta√ß√£o BrasilAPI: https://brasilapi.com.br/docs
- Google Maps API: https://developers.google.com/maps/documentation/geocoding
- OpenStreetMap Nominatim: https://nominatim.org/

---

**Pronto! Copie o prompt acima e cole no seu Replit AI para que ele atualize seu sistema.**
